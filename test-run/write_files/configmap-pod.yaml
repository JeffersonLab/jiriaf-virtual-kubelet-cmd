kind: ConfigMap
apiVersion: v1
metadata:
  name: leader-pid-1
  namespace: default
data:
  job1.leader_pid: |

---
kind: ConfigMap
apiVersion: v1
metadata:
  name: leader-pid-2
  namespace: default
data:
  job2.leader_pid: |

---

kind: ConfigMap
apiVersion: v1
metadata:
  name: job1
  namespace: default
data:
  job1.job: |
    #!/bin/bash
    sleep 10
    echo $message1 > ~/job1/job1.txt
    echo $message2 >> ~/job1/job1.txt


---

kind: ConfigMap
apiVersion: v1
metadata:
  name: job2
  namespace: default
data:
  job2.sh: |
    #!/bin/bash
    sleep 5
    echo $message3 > ~/job2/job2.txt

---

apiVersion: v1
kind: Pod
metadata:
  name: multijobs
spec:
  containers:
    - name: job1
      image: job1
      command: ["/bin/bash", "-c"]
      args: ["bash ~/job1/job1.job"]
      env:
        - name: message1
          value: "I'm env1"
        - name: message2
          value: "I'm env2"

      volumeMounts:
        - name: job1
          mountPath: ~/job1
        - name: leader-pid-1
          mountPath: ~/job1/leader
      resources:
        limits:
          cpu: "1"
          memory: 1Gi

    - name: job2
      image: job2
      command: ["/bin/bash", "-c"]
      args: ["bash ~/job2/job2.sh"]
      env:
        - name: message3
          value: "I'm env3"
      volumeMounts:
        - name: job2
          mountPath: ~/job2
        - name: leader-pid-2
          mountPath: ~/job2/leader
      resources:
        limits:
          cpu: "1"
          memory: 1Gi


  volumes:
    - name: job1 
      configMap:
        name: job1
    - name: job2
      configMap:
        name: job2
    - name: leader-pid-1
      configMap:
        name: leader-pid-1
    - name: leader-pid-2
      configMap:
        name: leader-pid-2

        
  nodeSelector:
    kubernetes.io/role: agent
  tolerations:
    - key: "virtual-kubelet.io/provider"
      value: "mock"
      effect: "NoSchedule"


---
